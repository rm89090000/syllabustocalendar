<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Syllabus → Calendar</title>

  <style>
    body {
      background: #f3f4f6;
      font-family: sans-serif;
    }
    .app-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
    }
    h1 {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    .upload-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 400px;
      margin-bottom: 20px;
    }
    .upload-form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .upload-form input {
      border: 1px solid #ccc;
      padding: 8px;
      border-radius: 6px;
    }
    .upload-form button {
      background: #2563eb;
      color: white;
      padding: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s ease-in-out;
    }
    .upload-form button:hover {
      background: #1e40af;
    }
    #calendar {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 10px;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .calendar-header button {
      padding: 6px 12px;
      background: #e5e7eb;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
    }
    .day {
      background: #fff;
      padding: 8px;
      min-height: 80px;
      border: 1px solid #e5e7eb;
      position: relative;
    }
    .day.empty {
      background: #f9fafb;
      border: none;
    }
    .day-number {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .event {
      background: #3b82f6;
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 12px;
      margin-bottom: 2px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + Babel from CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Our React Component -->
  <script type="text/babel">
    function CalendarApp() {
      const [events, setEvents] = React.useState([]);
      const [currentMonth, setCurrentMonth] = React.useState(new Date().getMonth());
      const [currentYear, setCurrentYear] = React.useState(new Date().getFullYear());

      const monthNames = [
        "January","February","March","April","May","June",
        "July","August","September","October","November","December"
      ];

      const handleUpload = async (e) => {
        e.preventDefault();
        const fileInput = document.getElementById("fileInput");
        if (!fileInput.files.length) return;

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        const res = await fetch("/upload", { method: "POST", body: formData });
        const data = await res.json();
        setEvents(data.events || []);
      };

      const renderCalendarDays = () => {
        const days = [];
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
          days.push(<div key={`empty-${i}`} className="day empty"></div>);
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const dayStr = `${currentYear}-${String(currentMonth + 1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
          const dayEvents = events.filter(ev => ev.date === dayStr);

          days.push(
            <div key={d} className="day">
              <div className="day-number">{d}</div>
              {dayEvents.map((ev, idx) => (
                <div key={idx} className="event">{ev.title}</div>
              ))}
            </div>
          );
        }
        return days;
      };

      return (
        <div className="app-container">
          <h1>Syllabus → Calendar</h1>

          <div className="upload-box">
            <form onSubmit={handleUpload} className="upload-form">
              <label>Upload your PDF syllabus(s):</label>
              <input type="file" id="fileInput" required />
              <button type="submit">Upload & Parse</button>
            </form>
          </div>

          <div id="calendar">
            <div className="calendar-header">
              <button onClick={() => {
                setCurrentMonth(prev => {
                  if (prev === 0) {
                    setCurrentYear(y => y - 1);
                    return 11;
                  }
                  return prev - 1;
                });
              }}>Prev</button>

              <div id="monthYear">{`${monthNames[currentMonth]} ${currentYear}`}</div>

              <button onClick={() => {
                setCurrentMonth(prev => {
                  if (prev === 11) {
                    setCurrentYear(y => y + 1);
                    return 0;
                  }
                  return prev + 1;
                });
              }}>Next</button>
            </div>

            <div className="calendar-grid">{renderCalendarDays()}</div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<CalendarApp />);
  </script>
</body>
</html>
